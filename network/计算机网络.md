1. PDU
    - PDU是指协议数据单元，用来描述通信协议。PDU是一个由二进制数据0和1组成的数据块，它由控制部分和数据部分组成：控制部分由若干个字段组成，就是通信双方遵循的规则和约定；数据部分一般为上一层次的协议数据单元，为了保证所传输的数据是有序的，并且是没有重复的，需要给传输的pdu设置序号

2. TCP/IP结构层次
    - 自底向上的层次依次是：网络接口层；IP层（互联网层）；TCP层（运输层）；应用层

3. TCP报文结构
    - ![shilitu](https://github.com/chuntaojun/Java_Note/blob/master/network/image/tcp-1.png)
    - 源端口、目的端口、序号和确认序号（TCP可靠传输的关键部分、一个字节一个序号）、首部长度、标志位（ACK、SYN、FIN）、滑动窗口（告知发送端接收端的缓存大小以此控制发送端的发送速率，从而达到流量控制）、检验和、紧急指针、选项和填充、数据
	- 对于一个只有一个IP的客户端来说，当它在应用层发起Connect操作时，它的源地址、目的地址、目的端口是确定的，而源端口是由操作系统指定(也可以事先通过bind来指定，稍后描述），操作系统将为了避免连接重用(相同的四元组），系统将保证对于相同的目的地址和端口将使用不同的本地端口，再依赖于net.ipv4.ip_local_port_range的限制，最多使用65535-1024个连接。如果采用主动bind的方式建立连接，出现了端口相同也将主动报错。
	- Nagle算法
		- 在数据传输过程中，通常会遇到一些小分组的传输（比如 41 bit的数据分组，除去TCP首部和IP首部真正传输的数据只有1 bit），像这种小分组多的话，在网络上传输就加大了造成网络拥塞的可能。为了提传输效率，所以提出了Nagle算法。这个算法要求一个TCP连接最多只能有一个未被确认的未完成的小分组，在该分组到达之前不能发送其他的小分组。然后，TCP会收集这些小分组，并在确认到来时以一个分组的方式发送出去，这样就可以有效的减少了小分组。 在一些实时性要求比较高的场景下，采用了Nagle算法会让用户感觉到时延，所以我们可以选择关闭Nagle算法，Socket API 可以用 TCP_NODELAY 选项来关闭，nginx上的 tcp_nodely也是采用的这个系统调用。
	- TCP滑动窗口
        - ![shilitu](https://github.com/chuntaojun/Java_Note/blob/master/network/image/tcp-2.png)
        - TCP在双方数据传输的过程中，都会维护一个窗口，它代表了我还可以接受的数据的大小。如果接收方窗口大小为0，发送方就会停止发送。之所以叫滑动窗口（Sliding Window）是因为它是动态可变的，不是固定的（张开、合拢、收缩）。它保证了数据的可靠传递、它确保数据按顺序传递、并且它强制发送者之间的流量控制
    - TCP拥塞控制
		- 慢启动和拥塞避免
            - 慢启动和拥塞避免算法必须被TCP发送端用来控制正在向网络输送的数据量。为了实现这些算法，必须向TCP每连接状态加入两个参量。拥塞窗口（cwnd）是对发送端收到确认（ACK）之前能向网络传送的最大数据量的一个发送端限制，接收端通知窗口（rwnd）是对未完成数据量的接收端限制。cwnd和rwnd的最小值决定了数据传送。 另一个状态参量，慢启动阀值（ssthresh），被用来确定是用慢启动还是用拥塞避免算法来控制数据传送。 在不清楚环境的情况下向网络传送数据，要求TCP缓慢地探测网络以确定可用流量，避免突然传送大量数据而使网络拥塞。在开始慢启动时cwnd为1，每收到一个用于确认新数据的ACK至多增加SMSS（SENDER MAXIMUM SEGMENT SIZE）字节。 慢启动算法在cwnd&lt;ssthresh时使用，拥塞避免算法在cwnd&gt;ssthresh时使用。当cwnd和ssthresh相等时，发送端既可以使用慢启动也可以使用拥塞避免。 当拥塞发生时，ssthresh被设置为当前窗口大小的一半（cwnd和接收方通告窗口大小的最小值，但最少为2个报文段）。如果是超时重传，cwnd被设置为1个报文段（这就是慢启动，其实慢启动也不慢，它是指数性增长，只是它的起始比较低）当达到ssthresh时，进入拥塞避免算法（拥塞避免是线性增长）。
            - ![shilitu](https://github.com/chuntaojun/Java_Note/blob/master/network/image/tcp-3.png)
    - 快速重传和快速恢复
        - 当接收端收到一个顺序混乱的数据，它应该立刻回复一个重复的ACK。这个ACK的目的是通知发送端收到了一个顺序紊乱的数据段，以及期望的序列号。发送端收到这个重复的ACK可能有多种原因，可能丢失或者是网络对数据重新排序等。在收到三个重复ACK之后（包含第一次收到的一共四个同样的ACK），TCP不等重传定时器超时就重传看起来已经丢失（可能数据绕路并没有丢失）的数据段。因为这个在网络上并没有超时重传那么恶劣，所以不会进入慢启动，而进入快速恢复。快速恢复首先会把ssthresh减半(一般还会四舍五入到数据段的倍数)，然后cwnd=ssthresh+收到重复ACK报文段累计的大小。
